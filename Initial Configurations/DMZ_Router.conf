en
conf t
hostname DMZ_Router

###############################
##### Disable HTTP server #####
###############################
no ip http server
no ip http secure-server

#######################
##### Config NTP ######
#######################
clock timezone SGT 8
ntp server 172.16.67.2 prefer
ntp logging

###################################
##### Set logging level to 6 ######
###################################
logging 172.16.67.2
logging trap 6
logging source-interface g0/0

vlan 81
name DMZ
exit

vlan 69
name Positions
exit

int vlan 81
ip address 172.16.81.1 255.255.255.248
no shut
exit

int vlan 69
ip address 172.16.69.1 255.255.255.252
no shut
exit

int g0/1
switchport mode trunk
switchport trunk allowed vlan add 69,81
no shut
exit

int range fa0/1-24
switchport mode access
switchport nonegotiate
switchport port-security 
switchport port-security maximum 1
switchport port-security mac-address sticky
shut
exit

int range fa0/1-2
switchport access vlan 81
no shut
exit

int fa0/3
switchport access vlan 69
no shut
exit


! -----------------------------------
! Create object groups for networks
object-group network PARTNERS
network-object 172.16.100.0 255.255.255.248
exit
object-group network ASSOCIATES
network-object 172.16.110.0 255.255.255.240
exit
object-group network LAW_CLERKS
network-object 172.16.200.0 255.255.255.248
exit
object-group network LEGAL_SECRETARIES
network-object 172.16.210.0 255.255.255.224
exit
object-group network IT_SUPPORT
network-object 172.16.30.0 255.255.255.248
exit
object-group network MARKETING_LEADS
network-object 172.16.31.0 255.255.255.248
exit
object-group network CHIEF_LEGAL_OFFICE
network-object 172.16.37.0 255.255.255.248
exit
object-group network INTERNAL_SERVER_FARM
network-object 172.16.66.0 255.255.255.248
exit
object-group network SYSLOG
network-object 172.16.67.0 255.255.255.252
exit
object-group network MANAGEMENT_VLAN
network-object 172.16.68.0 255.255.255.240
exit
object-group network HONEYPOT
network-object 172.16.69.0 255.255.255.252
exit
object-group network DMZ
network-object host 172.16.81.2
exit

object-group network INTERNAL_NETWORK
group-object PARTNERS
group-object ASSOCIATES
group-object LAW_CLERKS
group-object LEGAL_SECRETARIES
group-object IT_SUPPORT
group-object MARKETING_LEADS
group-object CHIEF_LEGAL_OFFICE
group-object INTERNAL_SEVER_FARM
exit

object-group network WAN_FACING_SERVICES
group-object DMZ
group-object HONEYPOT
exit

object-group network MANAGEMENT_NETWORK
group-object MANAGEMENT_VLAN
group-object SYSLOG
exit

! -----------------------------------
ip access-list extended RESTRICT_HONEY_OUTBOUND
deny ip object-group HONEYPOT object-group INTERNAL_NETWORK
deny ip object-group HONEYPOT object-group MANAGEMENT_NETWORK
deny ip object-group HONEYPOT object-group DMZ
deny ip object-group HONEYPOT object-group SYSLOG
permit ip object-group HONEYPOT any
exit

! Restrict HONEYPORT outbound traffic
int g0/2
ip access-group RESTRICT_HONEY_OUTBOUND in
exit
! -----------------------------------

no cdp run

# TODO Defences (DHCP Snooping, DAI)

############################
##### Creating SSH Key #####
############################
ip domain-name sea4eggs.sitict
crypto key generate rsa modulus 2048
ip ssh version 2

##########################
##### Enable TACACS+ #####
##########################
aaa new-model
tacacs server TACACSERVER
address ipv4 172.16.68.8
key Sea4EggsC0mpl3xP@ssw0rd
exit
ip tacacs source-interface g0/1
aaa authentication login default group tacacs+ local

###############################
##### Test authentication #####
###############################
test aaa group tacacs+ network_manager Rapes&Redwine legacy

##########################################
##### Enable privilege mode password #####
##########################################
enable algorithm-type sha256 secret SW1C0mpl3xP@ssw0rd

###########################################################
##### Create TACACS+ account for local authentication #####
###########################################################
username network_manager privilege 15 algorithm-type sha256 secret Rapes&Redwine

########################################################
##### Create local account for local authentication ####
######### Do not use unless absolutely required ########
########################################################
username sea4eggs-admin privilege 15 algorithm-type sha256 secret 1qwer$#@!~sea4eggs

##########################################
##### Enable ssh on virtual terminal #####
##########################################
line vty 0 15 
transport input ssh
login authentication default
exit

end
