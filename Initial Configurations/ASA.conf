# MANUALLY ENABLE AND GO TO CONF T

hostname TheGreatWall
domain-name sea4eggs.sitict.net

same-security-traffic permit inter-interface

# Disable the HTTP Management Service
#no dhcpd enable management
no http server enable
#no http 192.168.1.0 255.255.255.0 management

no snmp-server enable traps snmp authentication linkup linkdown coldstart warmstart
no call-home reporting anonymous

policy-map global_policy
class inspection_default
inspect icmp
exit
exit


interface GigabitEthernet0/0
nameif EDGE-WAN
security-level 0
ip address 172.16.0.2 255.255.255.252
no shutdown

interface GigabitEthernet0/1
nameif MGNT-SYSLOG
security-level 100
ip address 172.16.4.1 255.255.255.252
no shutdown

interface GigabitEthernet0/2
nameif DMZ
security-level 50
ip address 172.16.3.1 255.255.255.252 
no shutdown

interface GigabitEthernet0/3
shutdown
no nameif    
no security-level
no ip address
             
interface GigabitEthernet0/4
nameif L3SW1 
security-level 80
ip address 172.16.1.1 255.255.255.252
no shutdown

interface GigabitEthernet0/5
nameif L3SW2 
security-level 80
ip address 172.16.2.1 255.255.255.252
no shutdown

interface Management0/0
nameif management
security-level 100
ip address 172.16.68.2 255.255.255.240
no shutdown

exit

! Static routes
route EDGE-WAN 0.0.0.0 0.0.0.0 172.16.0.1 1
route MGNT-SYSLOG 172.16.67.0 255.255.255.252 172.16.4.2 1
route DMZ 172.16.81.0 255.255.255.252 172.16.3.2 1

route L3SW1 172.16.30.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.31.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.37.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.66.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.100.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.110.0 255.255.255.240 172.16.1.2 1
route L3SW1 172.16.200.0 255.255.255.248 172.16.1.2 1
route L3SW1 172.16.210.0 255.255.255.224 172.16.1.2 200

route L3SW2 172.16.30.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.31.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.37.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.66.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.100.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.110.0 255.255.255.240 172.16.2.2 200
route L3SW2 172.16.200.0 255.255.255.248 172.16.2.2 200
route L3SW2 172.16.210.0 255.255.255.224 172.16.2.2 1

route MGNT-SYSLOG 172.16.68.1 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.3 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.4 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.5 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.6 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.7 255.255.255.255 172.16.4.2
route MGNT-SYSLOG 172.16.68.8 255.255.255.255 172.16.4.2

ntp server 172.16.67.2 prefer

logging trap 6
logging host MGNT-SYSLOG 172.16.67.2
logging enable


! -----------------------------------
! Create object groups for networks
! -----------------------------------
object-group network PARTNERS
network-object 172.16.100.0 255.255.255.248
exit
object-group network ASSOCIATES
network-object 172.16.110.0 255.255.255.240
exit
object-group network LAW_CLERKS
network-object 172.16.200.0 255.255.255.248
exit
object-group network LEGAL_SECRETARIES
network-object 172.16.210.0 255.255.255.224
exit
object-group network IT_SUPPORT
network-object 172.16.30.0 255.255.255.248
exit
object-group network MARKETING_LEADS
network-object 172.16.31.0 255.255.255.248
exit
object-group network CHIEF_LEGAL_OFFICE
network-object 172.16.37.0 255.255.255.248
exit
object-group network INTERNAL_SERVER_FARM
network-object 172.16.66.0 255.255.255.248
exit
object-group network SYSLOG
network-object host 172.16.67.2
exit
object-group network MANAGEMENT_VLAN
network-object 172.16.68.0 255.255.255.240
exit
object-group network HONEYPOT
network-object host 172.16.69.2
exit
object-group network DMZ
network-object host 172.16.81.2
exit
object-group network TACACS_SERVER
network-object host 172.16.68.8
exit

! -----------------------------------
! Define the internal network object group
! -----------------------------------
object-group network INTERNAL_NETWORK
group-object PARTNERS
group-object ASSOCIATES
group-object LAW_CLERKS
group-object LEGAL_SECRETARIES
group-object IT_SUPPORT
group-object MARKETING_LEADS
group-object CHIEF_LEGAL_OFFICE
group-object INTERNAL_SERVER_FARM
exit

object-group network WAN_FACING_SERVICES
group-object DMZ
group-object HONEYPOT
exit

object-group network MANAGEMENT_NETWORK
group-object MANAGEMENT_VLAN
group-object SYSLOG
exit

object-group service SYSLOG_TRAFFIC
service-object udp destination eq 123
service-object udp destination eq 514
service-object tcp destination eq 9997
service-object icmp
exit

object-group service TACACS_TRAFFIC
service-object tcp destination eq 49
service-object icmp
exit

object-group service DMZ_TRAFFIC
service-object tcp destination eq 80
service-object tcp-udp destination eq 53
exit

object-group service HONEYPOT_TRAFFIC
service-object tcp destination eq 21
service-object tcp-udp destination eq 22
exit


! ------------------------------------ ACL for Policy Matching  ------------------------------------ !
access-list WAN_HTTP_SERVER extended permit tcp any4 object-group DMZ eq 80


! ----------------------------------- ACLs by Firewall Interface ----------------------------------- !
! -------- EDGE-WAN -------- !
# Permit Edge syslog, ntp, splunk traffic to syslog server
access-list EDGE_INBOUND extended permit object-group SYSLOG_TRAFFIC host 172.16.0.1 object-group SYSLOG

# Permit Edge's access to the TACACS server
access-list EDGE_INBOUND extended permit object-group TACACS_TRAFFIC host 172.16.0.1 object-group TACACS_SERVER

# Permit WAN traffic towards DMZ
access-list EDGE_INBOUND extended permit object-group DMZ_TRAFFIC any4 object-group DMZ

# Permit WAN traffic towards HONEYPOT
access-list EDGE_INBOUND extended permit object-group HONEYPOT_TRAFFIC any4 object-group HONEYPOT

# Apply access-list to firewall's WAN facing interface
access-group EDGE_INBOUND in interface EDGE-WAN


! -------- DMZ -------- !
# Permit DMZ syslog, ntp, splunk traffic to syslog server
access-list DMZ_INBOUND extended permit object-group SYSLOG_TRAFFIC host 172.16.81.2 object-group SYSLOG

# Permit DMZ router's syslog, ntp, splunk traffic to syslog server
access-list DMZ_INBOUND extended permit object-group SYSLOG_TRAFFIC host 172.16.3.2 object-group SYSLOG

# Permit DMZ router's access to the TACACS server
access-list DMZ_INBOUND extended permit object-group TACACS_TRAFFIC host 172.16.3.2 object-group TACACS_SERVER

# Deny DMZ to Internal
access-list DMZ_INBOUND extended deny ip host 172.16.3.2 object-group INTERNAL_NETWORK

# Deny DMZ to management network
access-list DMZ_INBOUND extended deny ip host 172.16.3.2 object-group MANAGEMENT_VLAN

# Permit all other traffic
access-list DMZ_INBOUND extended permit ip any any

# Apply access-list to firewall's DMZ facing interface
access-group DMZ_INBOUND in interface DMZ


! -------- L3SW1 -------- !
# ACL to restrict internal network to HONEY
access-list L3SW1_INBOUND extended deny ip object-group INTERNAL_NETWORK object-group HONEYPOT

# Allow internal server farm access to SYSLOG for sending logs
access-list L3SW1_INBOUND extended permit object-group SYSLOG_TRAFFIC object-group INTERNAL_SERVER_FARM object-group SYSLOG

# Allow IT Staffs to access MANAGEMENT_NETWORK
access-list L3SW1_INBOUND extended permit ip object-group IT_SUPPORT object-group MANAGEMENT_NETWORK

# Deny all other internal vlans access to MANAGEMENT_NETWORK
access-list L3SW1_INBOUND extended deny ip any object-group MANAGEMENT_NETWORK

# Permit internal to any other network
access-list L3SW1_INBOUND extended permit ip any any

# Apply access-list to firewall's L3SW1 facing interface
access-group L3SW1_INBOUND in interface L3SW1


! -------- L3SW2 -------- !
# ACL to restrict internal network to HONEY
access-list L3SW2_INBOUND extended deny ip object-group INTERNAL_NETWORK object-group HONEYPOT

# Allow internal server farm access to SYSLOG for sending logs
access-list L3SW2_INBOUND extended permit object-group SYSLOG_TRAFFIC object-group INTERNAL_SERVER_FARM object-group SYSLOG

# Allow IT Staffs to access MANAGEMENT_NETWORK
access-list L3SW2_INBOUND extended permit ip object-group IT_SUPPORT object-group MANAGEMENT_NETWORK

# Deny all other internal vlans access to MANAGEMENT_NETWORK
access-list L3SW2_INBOUND extended deny ip any object-group MANAGEMENT_NETWORK

# Permit internal to any other network
access-list L3SW2_INBOUND extended permit ip any any

# Apply access-list to firewall's L3SW2 facing interface
access-group L3SW2_INBOUND in interface L3SW2


class-map DMZ_HTTP_TRAFFIC
match access-list WAN_HTTP_SERVER
exit

policy-map INSPECT_DMZ_HTTP_TRAFFIC
class DMZ_HTTP_TRAFFIC
set connection embryonic-conn-max 10 per-client-embryonic-max 5
set connection per-client-max 15
set connection timeout idle 0:0:10
exit
exit

service-policy INSPECT_DMZ_HTTP_TRAFFIC interface EDGE-WAN

! --------------------------------------------------------------!

username sea4eggs-admin password 1qwer$#@!~sea4eggs
enable password C0mpl3xP@ssw0rd

ssh version 2
ssh timeout 30
ssh 172.16.68.0 255.255.255.240 management

aaa-server TACACSERVER protocol tacacs+
aaa-server TACACSERVER (MGNT-SYSLOG) host 172.16.68.8 Sea4EggsC0mpl3xP@ssw0rd
server-port 49
exit

aaa authentication ssh console TACACSERVER LOCAL

end
