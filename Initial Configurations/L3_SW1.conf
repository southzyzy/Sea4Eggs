###################################
##### Default Configurations ######
###################################
en
conf t
hostname L3_SW1

########################
##### Disable CDP ######
########################
no cdp run

################################
##### Disable HTTP servers #####
################################
no ip http server
no ip http secure-server

###################################
##### Set logging level to 6 ######
###################################
logging 172.16.67.2
logging trap 6
logging source-interface g0/0 vrf Mgmt-vrf
login on-success log
login on-failure log

#######################
##### Config NTP ######
#######################
clock timezone SGT 8
ntp server 172.16.67.2 prefer
ntp logging

#############################
##### Enable IP Routing #####
#############################
ip routing

########################
##### Create VLANs #####
########################
vlan 100
name Partners
exit

vlan 110
name Asscioate
exit

vlan 200
name "Law Clerks"
exit

vlan 210
name "Legal Secretary"
exit

vlan 300
name "IT Support"
exit

vlan 310
name Marketing
exit

vlan 37
name CLO
exit

vlan 66
name "Internal Servers"
exit

#######################
##### Create SVIs #####
#######################
int vlan 100
ip address 172.16.100.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.100.6
standby priority 150
standby preempt
no shut
exit

int vlan 110
ip address 172.16.110.1 255.255.255.240
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.110.14
standby priority 150
standby preempt
no shut
exit

int vlan 200
ip address 172.16.200.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.200.6
standby priority 150
standby preempt
no shut
exit

int vlan 300
ip address 172.16.30.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.30.6
standby priority 150
standby preempt
no shut
exit

int vlan 310
ip address 172.16.31.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.31.6
standby priority 150
standby preempt
no shut
exit

int vlan 37
ip address 172.16.37.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.37.6
standby priority 150
standby preempt
no shut
exit

int vlan 66
ip address 172.16.66.1 255.255.255.248
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.66.6
standby priority 150
standby preempt
no shut
exit

int vlan 210
ip address 172.16.210.1 255.255.255.224
ip helper-address 172.16.66.3
standby version 2
standby ip 172.16.210.30
no shut
exit

int g1/0/3
no switchport
ip address 172.16.1.2 255.255.255.252
no shut

int g1/0/1
switchport mode trunk
switchport trunk allowed vlan 100,110,200,300,310,37,66
no shut
exit

int g1/0/2
switchport mode access
switchport access vlan 210
no shut
exit

ip dhcp relay information trust-all

##########################
##### Enable Tacacs+ #####
##########################
aaa new-model
aaa group server tacacs+ TACACSERVER
server-private 172.16.68.8 key Sea4EggsC0mpl3xP@ssw0rd
ip vrf forwarding Mgmt-vrf
exit
ip tacacs source-interface g0/0
aaa authentication login default group TACACSERVER local

###############################
##### Test authentication #####
###############################
test aaa group TACACSERVER network_manager Rapes&Redwine legacy

##########################################
##### Enable privilege mode password #####
##########################################
enable algorithm-type sha256 secret C0mpl3xP@ssw0rd

###########################################################
##### Create TACACS+ account for local authentication #####
###########################################################
username network_manager privilege 15 algorithm-type sha256 secret Rapes&Redwine

########################################################
##### Create local account for local authentication ####
######### Do not use unless absolutely required ########
########################################################
username sea4eggs-admin privilege 15 algorithm-type sha256 secret 1qwer$#@!~sea4eggs

######################
##### Enable SSH #####
######################
ip domain-name sea4eggs.sitict.net
crypto key generate rsa modulus 2048
ip ssh version 2

##########################################
##### Enable ssh on virtual terminal #####
##########################################
line vty 0 15 
transport input ssh
login authentication default
exit

#############################
##### Set default route #####
#############################
ip route 0.0.0.0 0.0.0.0 172.16.1.1


#############################
##### Set TimeRange ACL #####
#############################
! -----------------------------------
! Create time range for office hours
time-range OFFICE_HOURS
periodic weekdays 9:00 to 18:00
exit

! Create ACL to restrict internet access to legal seceretaries
ip access-list extended RESTRICT_LEGAL_SECRETARIES
# Permit legal sec network to internal network (excluding itself)
permit ip 172.16.210.0 0.0.0.31 172.16.100.0 0.0.0.7
permit ip 172.16.210.0 0.0.0.31 172.16.110.0 0.0.0.15
permit ip 172.16.210.0 0.0.0.31 172.16.200.0 0.0.0.7
permit ip 172.16.210.0 0.0.0.31 172.16.30.0 0.0.0.7
permit ip 172.16.210.0 0.0.0.31 172.16.31.0 0.0.0.7
permit ip 172.16.210.0 0.0.0.31 172.16.37.0 0.0.0.7
permit ip 172.16.210.0 0.0.0.31 172.16.66.0 0.0.0.7
! Permit to DMZ
permit ip 172.16.210.0 0.0.0.31 172.16.81.0 0.0.0.3
deny   ip 172.16.210.0 0.0.0.31 any time-range OFFICE_HOURS
permit ip any any
exit

! Apply Restrict ACL for LEGAL SECRETARIES on its SVI
int vlan 210
ip access-group RESTRICT_LEGAL_SECRETARIES in
exit

! Permit DHCP and File Server access to Internal Server (same host)
!ip access-list extended PERMIT_INBOUND
# Permit inbound DNS, DHCP and HTTP traffic towards Internal Server
!permit udp any host 172.16.66.3 0.0.0.7 eq 53
!permit udp any host 172.16.66.3 0.0.0.7 eq 67
!permit udp any host 172.16.66.3 0.0.0.7 eq 68
!permit tcp any host 172.16.66.3 0.0.0.7 eq 80
!exit

! Apply Restrict ACL for INTERNAL SERVERS on its SVI
!int vlan 66
!ip access-group PERMIT_INBOUND out
!exit
! -----------------------------------

! TODO ACL
!	- ACLs
!	- Static Routes (done default route only so far)
!	- ACL on int G0/0 on R1 to allow SSH from Management VLAN only

end
