###################################
##### Default Configurations ######
###################################
en
config t
hostname Edge

########################
##### Disable CDP ######
########################
no cdp run

###############################
##### Disable HTTP server #####
###############################
no ip http server
no ip http secure-server

##############################
##### Set logging level ######
##############################
logging 172.16.67.2
logging trap 6

login on-success log
login on-failure log

#######################
##### Config NTP ######
#######################
clock timezone SGT 8
ntp server 172.16.67.2 prefer
ntp logging

#####################
##### IP routes #####
#####################
ip route 0.0.0.0 0.0.0.0 172.27.47.18
ip route 172.16.1.0 255.255.255.252 172.16.0.2
ip route 172.16.2.0 255.255.255.252 172.16.0.2
ip route 172.16.3.0 255.255.255.252 172.16.0.2
ip route 172.16.4.0 255.255.255.252 172.16.0.2
ip route 172.16.30.0 255.255.255.248 172.16.0.2
ip route 172.16.31.0 255.255.255.248 172.16.0.2
ip route 172.16.37.0 255.255.255.248 172.16.0.2
ip route 172.16.66.0 255.255.255.248 172.16.0.2
ip route 172.16.67.0 255.255.255.252 172.16.0.2
ip route 172.16.68.0 255.255.255.240 172.16.0.2
ip route 172.16.69.0 255.255.255.252 172.16.0.2
ip route 172.16.81.0 255.255.255.252 172.16.0.2
ip route 172.16.100.0 255.255.255.248 172.16.0.2
ip route 172.16.110.0 255.255.255.240 172.16.0.2
ip route 172.16.200.0 255.255.255.248 172.16.0.2
ip route 172.16.210.0 255.255.255.224 172.16.0.2

################################################
##### Configure interface towards internet #####
################################################
! ----- Shifted the ip nat inside / outside commands inside, if error (e.g. cannot config cuz no nat pool yet), bring it back dow
int g0/0
description WAN
ip address 172.27.47.17 255.255.255.248
ip nat outside
no shut
exit

################################################
##### Configure interface towards firewall #####
################################################
int g0/1
description EDGE
ip address 172.16.0.1 255.255.255.252
ip nat inside
ip flow monitor NetflowMonitor input
ip flow monitor NetflowMonitor output
no shut
exit

#################################
##### Shutdown unused ports #####
#################################
int range Serial0/0/0-1
no ip address
shutdown

#############################################
##### Create object groups for networks #####
#############################################
object-group network PARTNERS
172.16.100.0 255.255.255.248
exit
object-group network ASSOCIATES
172.16.110.0 255.255.255.240
exit
object-group network LAW_CLERKS
172.16.200.0 255.255.255.248
exit
object-group network LEGAL_SECRETARIES
172.16.210.0 255.255.255.224
exit
object-group network IT_SUPPORT
172.16.30.0 255.255.255.248
exit
object-group network MARKETING_LEADS
172.16.31.0 255.255.255.248
exit
object-group network CHIEF_LEGAL_OFFICE
172.16.37.0 255.255.255.248
exit
object-group network INTERNAL_SERVER_FARM
172.16.66.0 255.255.255.248
exit
object-group network SYSLOG
172.16.67.0 255.255.255.252
exit
object-group network MANAGEMENT_VLAN
172.16.68.0 255.255.255.240
exit
object-group network HONEYPOT
172.16.69.0 255.255.255.252
exit
object-group network DMZ
host 172.16.81.2
exit

object-group network INTERNAL_NETWORK
group-object PARTNERS
group-object ASSOCIATES
group-object LAW_CLERKS
group-object LEGAL_SECRETARIES
group-object IT_SUPPORT
group-object MARKETING_LEADS
group-object CHIEF_LEGAL_OFFICE
group-object INTERNAL_SERVER_FARM
exit

! -----------------------------------
! -- Anti-Spoofing -- !
!  Deny RFC 3330 special-use address
access-list 110 remark Deny special-use and private addresses
access-list 110 deny ip 0.0.0.0 0.0.0.0 any
access-list 110 deny ip 127.0.0.0 0.255.255.255 any
access-list 110 deny ip 192.0.2.0 0.0.0.255 any
access-list 110 deny ip 224.0.0.0 31.255.255.255 any

! Filter RFC 1918 space
access-list 110 deny ip 10.0.0.0 0.255.255.255 any
access-list 110 deny ip 192.168.0.0 0.0.255.255 any

! Deny your CIDR space coming in from Internet as source
access-list 110 deny ip object-group INTERNAL_NETWORK any

! Deny WAN from accessing internal infrastructure addresses
access-list 110 deny ip any object-group INTERNAL_NETWORK

! Permit transit traffic
access-list 110 permit ip any any

! Apply the ACL to the WAN facing interface
int g0/0
ip access-group 110 in
exit
! -----------------------------------

! ACL to permit Internet Access for everyone (except honeypot)
access-list 101 remark NAT access list
access-list 101 permit ip object-group INTERNAL_NETWORK any
access-list 101 permit ip object-group DMZ any
access-list 101 permit ip object-group SYSLOG any
access-list 101 permit ip object-group MANAGEMENT_VLAN any
access-list 101 permit ip object-group HONEYPOT any

! Configure the pool, and set the access ACL for the pool
ip nat pool PUBLIC 129.126.164.20 129.126.164.22 netmask 255.255.255.248
ip nat inside source list 101 pool PUBLIC overload

! Static NAT configurations (for DMZ Host)
ip nat inside source static tcp 172.16.81.2 53 129.126.164.17 53 extendable
ip nat inside source static udp 172.16.81.2 53 129.126.164.17 53 extendable
ip nat inside source static tcp 172.16.69.2 21 129.126.164.18 21 extendable
ip nat inside source static tcp 172.16.69.2 22 129.126.164.18 22 extendable
ip nat inside source static tcp 172.16.81.2 80 129.126.164.18 80 extendable


##########################
##### Enable Tacacs+ #####
##########################
aaa new-model
tacacs server TACACSERVER
address ipv4 172.16.68.8
key Sea4EggsC0mpl3xP@ssw0rd
exit
ip tacacs source-interface g0/1

#########################################
##### Set TACACS+ AAA configuration #####
#########################################
aaa authentication login default group tacacs+ local
aaa authentication enable default group tacacs+ enable

aaa authorization commands 15 default group tacacs+ local

aaa accounting commands 0 default start-stop group tacacs+
aaa accounting commands 15 default start-stop group tacacs+

###############################
##### Test authentication #####
###############################
test aaa group tacacs+ network_manager Rapes&Redwine legacy

##########################################
##### Enable privilege mode password #####
##########################################
enable algorithm-type sha256 secret C0mpl3xP@ssw0rd

########################################################
##### Create local account for local authentication ####
######### Do not use unless absolutely required ########
########################################################
username sea4eggs-admin privilege 15 algorithm-type sha256 secret 1qwer$#@!~sea4eggs

######################
##### Enable SSH #####
######################
ip domain-name intranet.sea4eggs.sitict.net
crypto key generate rsa modulus 2048
ip ssh version 2

##########################################
##### Enable ssh on virtual terminal #####
##########################################
line vty 0 15 
transport input ssh
login authentication default
exit

###########################
##### Netflow Configs #####
###########################
flow record NetflowTraffic
match ipv4 tos
match ipv4 protocol
match ipv4 source address
match ipv4 destination address
match transport source-port
match transport destination-port
match interface input
collect routing source as
collect routing destination as
collect interface output
collect counter bytes
collect counter packets
collect timestamp sys-uptime first
collect timestamp sys-uptime last
collect application name
 
flow exporter NetflowExport
destination 172.16.67.2
source GigabitEthernet0/1
transport udp 9991
export-protocol netflow-v9
template data timeout 60
option application-table timeout 60
option application-attributes timeout 300
 
flow monitor NetflowMonitor
exporter NetflowExport
cache timeout active 60
cache timeout inactive 15
record NetflowTraffic
